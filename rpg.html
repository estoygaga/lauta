<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mini RPG Definitivo</title>

<!-- SONIDOS -->
<audio id="hitSound" src="https://assets.mixkit.co/active_storage/sfx/2568/2568-preview.mp3"></audio>
<audio id="levelSound" src="https://assets.mixkit.co/active_storage/sfx/2761/2761-preview.mp3"></audio>

<style>
body{
    margin:0;
    background:#0e0e0e;
    font-family:Arial,sans-serif;
    color:#fff;
    display:flex;
    justify-content:center;
    align-items:center;
    min-height:100vh;
}
.game{
    background:#1b1b1b;
    padding:15px;
    border-radius:12px;
    width:95%;
    max-width:460px;
}
.stats{
    display:flex;
    justify-content:space-between;
    font-size:14px;
    margin-bottom:6px;
}
.map{
    display:grid;
    grid-template-columns:repeat(7,50px);
    gap:5px;
    justify-content:center;
    margin:10px 0;
}
.cell{
    width:50px;
    height:50px;
    background:#333;
    display:flex;
    justify-content:center;
    align-items:center;
    border-radius:6px;
    font-size:22px;
}
.player{background:#4caf50}
.enemy{background:#f44336}
.boss{background:#9c27b0}

.controls{
    display:grid;
    grid-template-columns:repeat(3,1fr);
    gap:6px;
}
button{
    padding:8px;
    border:none;
    border-radius:6px;
    cursor:pointer;
}
.panel{
    background:#2a2a2a;
    padding:8px;
    border-radius:8px;
    margin-top:8px;
    font-size:14px;
}
</style>
</head>

<body>

<div class="game">

    <!-- STATS -->
    <div class="stats">
        <div>â¤ï¸ <span id="hp">100</span></div>
        <div>âš”ï¸ <span id="atk">10</span></div>
        <div>â­ <span id="xp">0</span></div>
        <div>ğŸ† <span id="level">1</span></div>
    </div>

    <!-- MAPA -->
    <div class="map" id="map"></div>

    <!-- CONTROLES -->
    <div class="controls">
        <div></div>
        <button onclick="move(0,-1)">â¬†ï¸</button>
        <div></div>

        <button onclick="move(-1,0)">â¬…ï¸</button>
        <div></div>
        <button onclick="move(1,0)">â¡ï¸</button>

        <div></div>
        <button onclick="move(0,1)">â¬‡ï¸</button>
        <div></div>
    </div>

    <!-- ATAQUE -->
    <button onclick="attack()" style="width:100%;margin-top:6px;">
        âš”ï¸ Atacar
    </button>

    <!-- INVENTARIO -->
    <div class="panel">
        ğŸ§ª Pociones: <span id="potions">2</span>
        <button onclick="usePotion()">Usar</button><br><br>
        ğŸ—¡ï¸ Arma: <span id="weapon">BÃ¡sica</span><br>
        ğŸ’° Oro: <span id="gold">0</span>
    </div>

    <!-- TIENDA -->
    <div class="panel">
        ğŸ›’ <b>Tienda</b><br><br>
        <button onclick="buyPotion()">Comprar PociÃ³n (20ğŸ’°)</button><br><br>
        <button onclick="upgradeAttack()">Mejorar Ataque (30ğŸ’°)</button>
    </div>

    <!-- MISION -->
    <div class="panel">
        ğŸ“œ <b>MisiÃ³n</b><br>
        <span id="mission">Derrota a todos los enemigos</span>
    </div>

</div>

<!-- SONIDOS -->
<audio id="hitSound" src="https://assets.mixkit.co/active_storage/sfx/2568/2568-preview.mp3"></audio>
<audio id="levelSound" src="https://assets.mixkit.co/active_storage/sfx/2761/2761-preview.mp3"></audio>

<script>
const mapSize = 7;

let player = {
    x: 3,
    y: 3,
    hp: 100,
    maxHp: 100,
    attack: 10,
    xp: 0,
    level: 1,
    potions: 2,
    gold: 0,
    weapon: "BÃ¡sica"
};

let enemies = [];

const mapEl = document.getElementById("map");

function saveGame() {
    localStorage.setItem("rpgSave", JSON.stringify(player));
}

function loadGame() {
    const save = localStorage.getItem("rpgSave");
    if (save) player = JSON.parse(save);
}

function generateEnemies() {
    enemies = [];
    const isBoss = player.level % 3 === 0;
    const count = isBoss ? 1 : player.level + 1;

    for (let i = 0; i < count; i++) {
        enemies.push({
            x: Math.floor(Math.random() * mapSize),
            y: Math.floor(Math.random() * mapSize),
            hp: isBoss ? 100 + player.level * 20 : 30 + player.level * 10,
            damage: isBoss ? 20 : 6 + player.level * 2,
            boss: isBoss
        });
    }
}

function draw() {
    mapEl.innerHTML = "";

    for (let y = 0; y < mapSize; y++) {
        for (let x = 0; x < mapSize; x++) {
            const cell = document.createElement("div");
            cell.className = "cell";

            if (player.x === x && player.y === y) {
                cell.classList.add("player");
                cell.textContent = "ğŸ™‚";
            }

            enemies.forEach(e => {
                if (e.hp > 0 && e.x === x && e.y === y) {
                    cell.classList.add(e.boss ? "boss" : "enemy");
                    cell.textContent = e.boss ? "ğŸ‘¹" : "ğŸ‘¾";
                }
            });

            mapEl.appendChild(cell);
        }
    }

    hp.textContent = player.hp;
    atk.textContent = player.attack;
    xp.textContent = player.xp;
    level.textContent = player.level;
    potions.textContent = player.potions;
    gold.textContent = player.gold;
    weapon.textContent = player.weapon;
}

function move(dx, dy) {
    const nx = player.x + dx;
    const ny = player.y + dy;
    if (nx < 0 || ny < 0 || nx >= mapSize || ny >= mapSize) return;
    player.x = nx;
    player.y = ny;
    draw();
}

function attack() {
    let hit = false;

    enemies.forEach(e => {
        const d = Math.abs(player.x - e.x) + Math.abs(player.y - e.y);
        if (d === 1 && e.hp > 0) {
            e.hp -= player.attack;
            player.hp -= e.damage;
            hit = true;
            document.getElementById("hitSound").play();
        }
    });

    enemies = enemies.filter(e => e.hp > 0);

    if (!hit) alert("âŒ No hay enemigo cerca");

    if (player.hp <= 0) {
        alert("ğŸ’€ Has muerto");
        localStorage.removeItem("rpgSave");
        location.reload();
    }

    if (enemies.length === 0) {
        player.xp += 25;
        player.gold += 20;

        if (player.xp >= player.level * 50) {
            player.level++;
            player.maxHp += 20;
            player.hp = player.maxHp;
            document.getElementById("levelSound").play();
            alert("â¬†ï¸ Subiste a nivel " + player.level);
        }

        generateEnemies();
    }

    saveGame();
    draw();
}

function usePotion() {
    if (player.potions > 0 && player.hp < player.maxHp) {
        player.hp = Math.min(player.hp + 40, player.maxHp);
        player.potions--;
        saveGame();
        draw();
    }
}

function buyPotion() {
    if (player.gold >= 20) {
        player.gold -= 20;
        player.potions++;
        saveGame();
        draw();
    }
}

function upgradeAttack() {
    if (player.gold >= 30) {
        player.gold -= 30;
        player.attack += 5;
        player.weapon = "Espada +" + player.attack;
        saveGame();
        draw();
    }
}

loadGame();
generateEnemies();
draw();
</script>

</body>
</html>

