<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>RPG Medieval 2D</title>

<style>
body {
    margin: 0;
    background: #111;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
}
canvas {
    background: linear-gradient(#6ec6ff, #b3e5fc);
    image-rendering: pixelated;
}
</style>
</head>

<body>

<canvas id="game" width="1000" height="500"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

const gravity = 0.6;
const groundY = canvas.height - 60;

// ================= SPRITES =================
function loadSprite(src, frames) {
    const img = new Image();
    img.src = src;
    return { img, frames };
}

const knightSprites = {
    idle: loadSprite("Sprites/Knight/Idle.png", 6),
    run: loadSprite("Sprites/Knight/Run.png", 8),
    jump: loadSprite("Sprites/Knight/Jump.png", 10),
    attack1: loadSprite("Sprites/Knight/Attack_1.png", 4),
    attack2: loadSprite("Sprites/Knight/Attack_2.png", 3),
    kick: loadSprite("Sprites/Knight/Attack_3.png", 4),
    shield: loadSprite("Sprites/Knight/Shield.png", 2),
    dead: loadSprite("Sprites/Knight/Dead.png", 3)
};

const enemySprites = {
    idle: loadSprite("Sprites/Knight/Enemy/Idle.png", 6),
    walk: loadSprite("Sprites/Knight/Enemy/Walk.png", 10),
    attack: loadSprite("Sprites/Knight/Enemy/Attack.png", 5),
    hurt: loadSprite("Sprites/Knight/Enemy/Hurt.png", 4),
    dead: loadSprite("Sprites/Knight/Enemy/Dead.png", 5)
};

// ================= PLAYER =================
const player = {
    x: 200,
    y: 0,
    w: 96,
    h: 96,
    vx: 0,
    vy: 0,
    speed: 4,
    jump: -12,
    grounded: false,
    facing: 1,
    state: "idle",
    frame: 0,
    frameTime: 0,
    attacking: false,
    attackToggle: false,
    hp: 100,
    alive: true
};

// ================= ENEMY =================
const enemy = {
    x: 650,
    y: 0,
    w: 96,
    h: 96,
    vx: -1.2,
    state: "idle",
    frame: 0,
    frameTime: 0,
    hp: 50,
    alive: true,
    facing: -1,
    hurtTimer: 0
};

// ================= INPUT =================
const keys = {};
window.addEventListener("keydown", e => keys[e.key] = true);
window.addEventListener("keyup", e => keys[e.key] = false);

// ================= COMBAT =================
function rectHit(a, b) {
    return (
        a.x < b.x + b.w &&
        a.x + a.w > b.x &&
        a.y < b.y + b.h &&
        a.y + a.h > b.y
    );
}

// ================= UPDATE =================
function updatePlayer() {
    if (!player.alive) return;

    player.vx = 0;

    if (!player.attacking) {
        if (keys["a"]) {
            player.vx = -player.speed;
            player.facing = -1;
            player.state = "run";
        } else if (keys["d"]) {
            player.vx = player.speed;
            player.facing = 1;
            player.state = "run";
        } else {
            player.state = "idle";
        }
    }

    if (keys["w"] && player.grounded) {
        player.vy = player.jump;
        player.grounded = false;
        player.state = "jump";
    }

    if (keys["j"] && !player.attacking) {
        player.attacking = true;
        player.attackToggle = !player.attackToggle;
        player.state = player.attackToggle ? "attack1" : "attack2";
        player.frame = 0;
    }

    if (keys["k"] && !player.attacking) {
        player.attacking = true;
        player.state = "kick";
        player.frame = 0;
    }

    if (keys["s"]) {
        player.state = "shield";
    }

    player.vy += gravity;
    player.x += player.vx;
    player.y += player.vy;

    if (player.y + player.h >= groundY) {
        player.y = groundY - player.h;
        player.vy = 0;
        player.grounded = true;
    }

    animatePlayer();
}

function updateEnemy() {
    if (!enemy.alive) return;

    const distance = Math.abs(player.x - enemy.x);

    if (enemy.hurtTimer > 0) {
        enemy.hurtTimer--;
        enemy.state = "hurt";
    } else if (distance < 70) {
        enemy.state = "attack";
    } else if (distance < 300) {
        enemy.state = "walk";
        enemy.vx = player.x < enemy.x ? -1.2 : 1.2;
    } else {
        enemy.state = "idle";
        enemy.vx = 0;
    }

    enemy.x += enemy.vx;
    animateEnemy();
}

// ================= ANIMATION =================
function animatePlayer() {
    player.frameTime++;
    if (player.frameTime > 6) {
        player.frame++;
        const max = knightSprites[player.state].frames;
        if (player.frame >= max) {
            player.frame = 0;
            if (player.attacking) player.attacking = false;
        }
        player.frameTime = 0;
    }
}

function animateEnemy() {
    enemy.frameTime++;
    if (enemy.frameTime > 7) {
        enemy.frame++;
        const max = enemySprites[enemy.state].frames;
        if (enemy.frame >= max) enemy.frame = 0;
        enemy.frameTime = 0;
    }
}

// ================= DRAW =================
function drawSprite(sprite, x, y, w, h, frame, flip) {
    const size = 128;
    ctx.save();
    ctx.translate(x + w / 2, y);
    ctx.scale(flip, 1);
    ctx.drawImage(
        sprite.img,
        frame * size, 0,
        size, size,
        -w / 2, 0,
        w, h
    );
    ctx.restore();
}

function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // suelo
    ctx.fillStyle = "#2e7d32";
    ctx.fillRect(0, groundY, canvas.width, 60);

    drawSprite(
        knightSprites[player.state],
        player.x, player.y,
        player.w, player.h,
        player.frame,
        player.facing
    );

    if (enemy.alive) {
        drawSprite(
            enemySprites[enemy.state],
            enemy.x, enemy.y,
            enemy.w, enemy.h,
            enemy.frame,
            enemy.facing
        );
    }
}

// ================= LOOP =================
function loop() {
    updatePlayer();
    updateEnemy();
    draw();
    requestAnimationFrame(loop);
}

loop();
</script>

</body>
</html>

