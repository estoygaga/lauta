<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>RPG Medieval 2D</title>

<style>
body {
    margin: 0;
    background: #111;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
}

canvas {
    background: linear-gradient(#6ec6ff, #b3e5fc);
    image-rendering: pixelated;
}

#gameOver {
    position: absolute;
    display: none;
    flex-direction: column;
    align-items: center;
    color: white;
    font-family: Arial;
}

#gameOver button {
    padding: 10px 20px;
    font-size: 18px;
    cursor: pointer;
}
</style>
</head>

<body>

<canvas id="game" width="1000" height="500"></canvas>

<div id="gameOver">
    <h1>GAME OVER</h1>
    <button onclick="respawn()">RESPAWN</button>
</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

const gravity = 0.6;
const groundY = canvas.height - 50;

// =======================
// PLAYER SPRITES
// =======================
const sprites = {
    idle:   { img: "Sprites/Knight/Idle.png", frames: 6 },
    run:    { img: "Sprites/Knight/Run.png", frames: 8 },
    jump:   { img: "Sprites/Knight/Jump.png", frames: 10 },
    attack1:{ img: "Sprites/Knight/Attack_1.png", frames: 4 },
    attack2:{ img: "Sprites/Knight/Attack_2.png", frames: 3 },
    kick:   { img: "Sprites/Knight/Attack_3.png", frames: 4 },
    shield: { img: "Sprites/Knight/Shield.png", frames: 2 },
    dead:   { img: "Sprites/Knight/Dead.png", frames: 3 }
};

for (let s in sprites) {
    sprites[s].image = new Image();
    sprites[s].image.src = sprites[s].img;
}

// =======================
// PLAYER
// =======================
const player = {
    x: 150,
    y: groundY - 96,
    w: 96,
    h: 96,
    vx: 0,
    vy: 0,
    speed: 4,
    jump: -12,
    grounded: false,
    state: "idle",
    frame: 0,
    frameTime: 0,
    facing: 1,
    alive: true,
    attackToggle: false
};

// =======================
// ENEMY SPRITE
// =======================
const enemySprite = {
    image: new Image(),
    frames: 6
};
enemySprite.image.src = "Sprites/Knight/Enemy/Idle.png";

// =======================
// ENEMY
// =======================
const enemy = {
    x: 650,
    y: groundY - 96,
    w: 96,
    h: 96,
    frame: 0,
    frameTime: 0,
    facing: -1
};

// =======================
// INPUT
// =======================
const keys = {};
window.addEventListener("keydown", e => keys[e.key] = true);
window.addEventListener("keyup", e => keys[e.key] = false);

// =======================
// UPDATE
// =======================
function update() {
    if (!player.alive) return;

    player.vx = 0;

    if (keys["a"]) {
        player.vx = -player.speed;
        player.facing = -1;
        player.state = "run";
    } else if (keys["d"]) {
        player.vx = player.speed;
        player.facing = 1;
        player.state = "run";
    } else {
        player.state = "idle";
    }

    if (keys["w"] && player.grounded) {
        player.vy = player.jump;
        player.grounded = false;
        player.state = "jump";
    }

    if (keys["j"]) {
        player.state = player.attackToggle ? "attack2" : "attack1";
    }

    if (keys["k"]) player.state = "kick";
    if (keys["s"]) player.state = "shield";
    if (keys["x"]) die();

    player.vy += gravity;
    player.x += player.vx;
    player.y += player.vy;

    if (player.y + player.h >= groundY) {
        player.y = groundY - player.h;
        player.vy = 0;
        player.grounded = true;
    }

    animatePlayer();
    animateEnemy();
}

// =======================
// ANIMATION
// =======================
function animatePlayer() {
    player.frameTime++;
    if (player.frameTime > 6) {
        player.frame++;
        const max = sprites[player.state].frames;
        if (player.frame >= max) {
            player.frame = 0;
            if (player.state === "attack1" || player.state === "attack2") {
                player.attackToggle = !player.attackToggle;
            }
        }
        player.frameTime = 0;
    }
}

function animateEnemy() {
    enemy.frameTime++;
    if (enemy.frameTime > 10) {
        enemy.frame++;
        if (enemy.frame >= enemySprite.frames) enemy.frame = 0;
        enemy.frameTime = 0;
    }
}

// =======================
// DRAW
// =======================
function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // SUELO
    ctx.fillStyle = "#3e7c3e";
    ctx.fillRect(0, groundY, canvas.width, 50);

    // PLAYER
    const pSprite = sprites[player.state];
    drawSprite(
        pSprite.image,
        player.frame,
        player.x,
        player.y,
        player.w,
        player.h,
        player.facing
    );

    // ENEMY
    drawSprite(
        enemySprite.image,
        enemy.frame,
        enemy.x,
        enemy.y,
        enemy.w,
        enemy.h,
        enemy.facing
    );
}

function drawSprite(img, frame, x, y, w, h, facing) {
    const frameSize = 128;
    ctx.save();
    ctx.translate(x + w / 2, y);
    ctx.scale(facing, 1);
    ctx.drawImage(
        img,
        frame * frameSize, 0,
        frameSize, frameSize,
        -w / 2, 0,
        w, h
    );
    ctx.restore();
}

// =======================
// DEATH & RESPAWN
// =======================
function die() {
    player.alive = false;
    player.state = "dead";
    document.getElementById("gameOver").style.display = "flex";
}

function respawn() {
    player.x = 150;
    player.y = groundY - 96;
    player.vx = 0;
    player.vy = 0;
    player.alive = true;
    player.state = "idle";
    document.getElementById("gameOver").style.display = "none";
}

// =======================
function loop() {
    update();
    draw();
    requestAnimationFrame(loop);
}

loop();
</script>
</body>
</html>

