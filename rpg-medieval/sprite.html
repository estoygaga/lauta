<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>RPG Medieval</title>

<style>
body {
    margin: 0;
    background: black;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
}
canvas {
    background: #87ceeb;
    image-rendering: pixelated;
    border: 2px solid black;
}
</style>
</head>
<body>

<canvas id="game" width="800" height="400"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

/* =====================
   IMÁGENES
===================== */
const idleImage   = new Image();
const runImage    = new Image();
const jumpImage   = new Image();
const attackImage = new Image();

idleImage.src   = "./Sprites/Knight/Idle.png";
runImage.src    = "./Sprites/Knight/Run.png";
jumpImage.src   = "./Sprites/Knight/Jump.png";
attackImage.src = "./Sprites/Knight/Attack_1.png";

/* =====================
   SPRITE DATA
===================== */
const FRAME_WIDTH  = 128;
const FRAME_HEIGHT = 128;

const IDLE_FRAMES   = 6;
const RUN_FRAMES    = 8;
const JUMP_FRAMES   = 10;
const ATTACK_FRAMES = 4;

let currentFrame = 0;
let frameTimer   = 0;
const FRAME_SPEED = 6;

/* =====================
   FÍSICA
===================== */
const gravity = 0.6;
const groundY = 220;

/* =====================
   PLAYER
===================== */
const player = {
    x: 336,
    y: groundY,
    vy: 0,
    speed: 3,
    direction: 1,   // 1 derecha, -1 izquierda
    moving: false,
    jumping: false,
    attacking: false
};

/* =====================
   INPUT
===================== */
const keys = {};
window.addEventListener("keydown", e => {
    keys[e.code] = true;
    if (e.code === "Space") e.preventDefault();
});
window.addEventListener("keyup", e => keys[e.code] = false);

/* =====================
   LOOP
===================== */
function loop() {
    update();
    draw();
    requestAnimationFrame(loop);
}

/* =====================
   UPDATE
===================== */
function update() {
    player.moving = false;

    // ATAQUE (Z)
    if (keys["KeyZ"] && !player.attacking && !player.jumping) {
        player.attacking = true;
        currentFrame = 0;
        frameTimer = 0;
    }

    // Movimiento horizontal (bloqueado al atacar)
    if (!player.attacking) {
        if (keys["ArrowRight"]) {
            player.x += player.speed;
            player.direction = 1;
            player.moving = true;
        }
        if (keys["ArrowLeft"]) {
            player.x -= player.speed;
            player.direction = -1;
            player.moving = true;
        }
    }

    // Salto (bloqueado al atacar)
    if (keys["Space"] && !player.jumping && !player.attacking) {
        player.vy = -12;
        player.jumping = true;
        currentFrame = 0;
    }

    // Gravedad
    if (player.jumping) {
        player.vy += gravity;
        player.y += player.vy;

        if (player.y >= groundY) {
            player.y = groundY;
            player.vy = 0;
            player.jumping = false;
            currentFrame = 0;
        }
    }

    // Animación
    frameTimer++;
    if (frameTimer >= FRAME_SPEED) {
        frameTimer = 0;
        currentFrame++;

        let maxFrames = IDLE_FRAMES;
        if (player.attacking) maxFrames = ATTACK_FRAMES;
        else if (player.jumping) maxFrames = JUMP_FRAMES;
        else if (player.moving) maxFrames = RUN_FRAMES;

        // Fin del ataque
        if (player.attacking && currentFrame >= ATTACK_FRAMES) {
            player.attacking = false;
            currentFrame = 0;
        }

        if (currentFrame >= maxFrames) currentFrame = 0;
    }
}

/* =====================
   DRAW
===================== */
function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    let sprite = idleImage;
    if (player.attacking) sprite = attackImage;
    else if (player.jumping) sprite = jumpImage;
    else if (player.moving) sprite = runImage;

    ctx.save();
    ctx.scale(player.direction, 1);

    ctx.drawImage(
        sprite,
        currentFrame * FRAME_WIDTH,
        0,
        FRAME_WIDTH,
        FRAME_HEIGHT,
        player.direction === 1 ? player.x : -player.x - FRAME_WIDTH,
        player.y,
        FRAME_WIDTH,
        FRAME_HEIGHT
    );

    ctx.restore();
}

loop();
</script>

</body>
</html>

