<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>RPG Medieval 2D</title>
<style>
body {
    margin: 0;
    background: #111;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    overflow: hidden;
}
canvas {
    border: 3px solid black;
    image-rendering: pixelated;
    background: #87ceeb;
}
</style>
</head>
<body>

<canvas id="game" width="800" height="400"></canvas>

<script>
/* ======================
   CONFIGURACIÓN
====================== */
const knightIdle = new Image();
knightIdle.src = "Sprites/Knight/Idle.png";

knightIdle.onload = () => {
    console.log("IMAGEN IDLE CARGADA OK");
};

knightIdle.onerror = () => {
    console.error("ERROR: NO SE PUDO CARGAR Sprites/Knight/Igle.png");
};
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

const TILE = 32;
const gravity = 0.6;

const RESPAWN_X = 200;
const RESPAWN_Y = 0;
const DEATH_Y = 600;

/* ======================
   MAPA MEDIEVAL
====================== */
const map = [
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
    [2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2],
    [3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3]
];

/* ======================
   JUGADOR (CABALLERO)
====================== */
const player = {
    x: RESPAWN_X,
    y: RESPAWN_Y,
    w: 28,
    h: 40,
    vx: 0,
    vy: 0,
    speed: 3,
    jumping: false,
    dir: 1,
    attacking: false,
    attackTimer: 0
};

/* ======================
   CONTROLES (SIN SCROLL)
====================== */
const keys = {};
document.addEventListener("keydown", e => {
    if (["ArrowLeft","ArrowRight","Space","KeyZ"].includes(e.code)) {
        e.preventDefault();
    }
    keys[e.code] = true;
});
document.addEventListener("keyup", e => {
    if (["ArrowLeft","ArrowRight","Space","KeyZ"].includes(e.code)) {
        e.preventDefault();
    }
    keys[e.code] = false;
});

/* ======================
   COLISIONES
====================== */
function collide(rect) {
    for (let y = 0; y < map.length; y++) {
        for (let x = 0; x < map[y].length; x++) {
            if (map[y][x] !== 0) {
                const tile = {
                    x: x * TILE,
                    y: y * TILE,
                    w: TILE,
                    h: TILE
                };
                if (
                    rect.x < tile.x + tile.w &&
                    rect.x + rect.w > tile.x &&
                    rect.y < tile.y + tile.h &&
                    rect.y + rect.h > tile.y
                ) {
                    return tile;
                }
            }
        }
    }
    return null;
}

/* ======================
   UPDATE
====================== */
function update() {
    player.vx = 0;

    if (keys["ArrowLeft"]) {
        player.vx = -player.speed;
        player.dir = -1;
    }
    if (keys["ArrowRight"]) {
        player.vx = player.speed;
        player.dir = 1;
    }

    if (keys["Space"] && !player.jumping) {
        player.vy = -12;
        player.jumping = true;
    }

    // Ataque
    if (keys["KeyZ"] && !player.attacking) {
        player.attacking = true;
        player.attackTimer = 15;
    }

    if (player.attacking) {
        player.attackTimer--;
        if (player.attackTimer <= 0) {
            player.attacking = false;
        }
    }

    player.vy += gravity;

    // Movimiento X
    player.x += player.vx;
    if (collide(player)) player.x -= player.vx;

    // Movimiento Y
    player.y += player.vy;
    const hit = collide(player);
    if (hit) {
        if (player.vy > 0) {
            player.y = hit.y - player.h;
            player.jumping = false;
        }
        player.vy = 0;
    }

    // Respawn al caer
    if (player.y > DEATH_Y) {
        player.x = RESPAWN_X;
        player.y = RESPAWN_Y;
        player.vy = 0;
        player.jumping = false;
    }
}

/* ======================
   CÁMARA
====================== */
function camera() {
    return {
        x: player.x - canvas.width / 2,
        y: player.y - canvas.height / 2
    };
}

/* ======================
   DIBUJO
====================== */
function draw() {
    ctx.clearRect(0,0,canvas.width,canvas.height);
    const cam = camera();

    // Mapa
    for (let y = 0; y < map.length; y++) {
        for (let x = 0; x < map[y].length; x++) {
            if (map[y][x] !== 0) {
                ctx.fillStyle =
                    map[y][x] === 1 ? "#4caf50" :
                    map[y][x] === 2 ? "#8d6e63" :
                    "#9e9e9e";
                ctx.fillRect(
                    x * TILE - cam.x,
                    y * TILE - cam.y,
                    TILE,
                    TILE
                );
            }
        }
    }

    // Caballero
    ctx.save();
ctx.translate(player.x - cam.x, player.y - cam.y);

ctx.drawImage(
    knightIdle,
    0, 0,          // frame X, Y (por ahora el primero)
    64, 64,        // tamaño del frame
    0, -64,        // posición sobre el jugador
    64, 64
);

ctx.restore();


    // Espada (hitbox)
    if (player.attacking) {
        ctx.fillStyle = "rgba(255,0,0,0.5)";
        ctx.fillRect(
            player.x - cam.x + (player.dir === 1 ? player.w : -20),
            player.y - cam.y - 30,
            20,
            10
        );
    }
}

/* ======================
   LOOP
====================== */
function loop() {
    update();
    draw();
    requestAnimationFrame(loop);
}
loop();
</script>

</body>
</html>

